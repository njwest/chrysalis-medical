function CVShapeItemElement(t,s,e){this.lcEnum={1:"butt",2:"round",3:"butt"},this.ljEnum={1:"miter",2:"round",3:"bevel"},this.stylesList=[],this.viewData=[],this.elemData=t,this.data=t.shapes,this.globalData=e,this.firstFrame=!0,this.searchShapes(this.data,this.viewData,s,[])}CVShapeItemElement.prototype.dashResetter=[],CVShapeItemElement.prototype.searchShapes=function(t,s,e,r){var a,o,i,l,p=t.length-1,h=[],m=[];for(a=p;a>=0;a-=1)if("fl"==t[a].ty||"st"==t[a].ty){if(l={type:t[a].ty,elements:[]},s[a]={},s[a].c=PropertyFactory.getProp(this.elemData,t[a].c,1,null,e),s[a].c.k||(l.co="rgb("+bm_floor(s[a].c.v[0])+","+bm_floor(s[a].c.v[1])+","+bm_floor(s[a].c.v[2])+")"),s[a].o=PropertyFactory.getProp(this.elemData,t[a].o,0,.01,e),"st"==t[a].ty&&(l.lc=this.lcEnum[t[a].lc]||"round",l.lj=this.ljEnum[t[a].lj]||"round",1==t[a].lj&&(l.ml=t[a].ml),s[a].w=PropertyFactory.getProp(this.elemData,t[a].w,0,null,e),s[a].w.k||(l.wi=s[a].w.v),t[a].d)){var y=PropertyFactory.getDashProp(this.elemData,t[a].d,"canvas",e);s[a].d=y,s[a].d.k||(l.da=s[a].d.dasharray,l.do=s[a].d.dashoffset)}this.stylesList.push(l),s[a].style=l,h.push(s[a].style)}else if("gr"==t[a].ty)s[a]={it:[]},this.searchShapes(t[a].it,s[a].it,e,r);else if("tr"==t[a].ty)s[a]={transform:{mat:new Matrix,opacity:1,matMdf:!1,opMdf:!1,op:PropertyFactory.getProp(this.elemData,t[a].o,0,.01,e),mProps:PropertyFactory.getProp(this.elemData,t[a],2,null,e)},elements:[]};else if("sh"==t[a].ty||"rc"==t[a].ty||"el"==t[a].ty){s[a]={nodes:[],trNodes:[],tr:[0,0,0,0,0,0]};var n=4;"rc"==t[a].ty?n=5:"el"==t[a].ty&&(n=6),s[a].sh=PropertyFactory.getShapeProp(this.elemData,t[a],n,e,r),i=this.stylesList.length;var f=!1,d=!1;for(o=0;o<i;o+=1)this.stylesList[o].closed||(this.stylesList[o].elements.push(s[a]),"st"===this.stylesList[o].type?f=!0:d=!0);s[a].st=f,s[a].fl=d}else if("tm"==t[a].ty){var c={closed:!1,trimProp:PropertyFactory.getProp(this.elemData,t[a],7,null,e)};r.push(c),m.push(c)}for(p=h.length,a=0;a<p;a+=1)h[a].closed=!0;for(p=m.length,a=0;a<p;a+=1)m[a].closed=!0},CVShapeItemElement.prototype.renderShape=function(t,s,e,r){var a,o;if(!s)for(s=this.data,o=this.stylesList.length,a=0;a<o;a+=1)this.stylesList[a].d="",this.stylesList[a].mdf=!1;e||(e=this.viewData),o=s.length-1;var i,l;for(i=t,a=o;a>=0;a-=1)if("tr"==s[a].ty){i=e[a].transform;var p=e[a].transform.mProps.v.props;if(i.matMdf=i.mProps.mdf,i.opMdf=i.op.mdf,l=i.mat,l.reset(),t){var h=t.mat.props;i.opacity=t.opacity,i.opacity*=e[a].transform.op.v,i.matMdf=!!t.matMdf||i.matMdf,i.opMdf=!!t.opMdf||i.opMdf,l.transform(h[0],h[1],h[2],h[3],h[4],h[5])}else i.opacity=i.op.o;l.transform(p[0],p[1],p[2],p[3],p[4],p[5])}else"sh"==s[a].ty||"el"==s[a].ty||"rc"==s[a].ty?this.renderPath(s[a],e[a],i):"fl"==s[a].ty?this.renderFill(s[a],e[a],i):"st"==s[a].ty?this.renderStroke(s[a],e[a],i):"gr"==s[a].ty?this.renderShape(i,s[a].it,e[a].it):"tm"==s[a].ty;if(r){o=this.stylesList.length;var m,y,n,f,d,c,v,u=this.globalData.renderer,g=this.globalData.canvasContext;for(a=0;a<o;a+=1)if(v=this.stylesList[a].type,"st"!==v||0!==this.stylesList[a].wi){for(u.save(),d=this.stylesList[a].elements,y=d.length,"st"===v?(g.strokeStyle=this.stylesList[a].co,g.lineWidth=this.stylesList[a].wi,g.lineCap=this.stylesList[a].lc,g.lineJoin=this.stylesList[a].lj,g.miterLimit=this.stylesList[a].ml):g.fillStyle=this.stylesList[a].co,u.ctxOpacity(this.stylesList[a].coOp),g.beginPath(),m=0;m<y;m+=1){for("st"===v?(u.save(),g.beginPath(),this.stylesList[a].da?(g.setLineDash(this.stylesList[a].da),g.lineDashOffset=this.stylesList[a].do,this.globalData.isDashed=!0):this.globalData.isDashed&&(g.setLineDash(this.dashResetter),this.globalData.isDashed=!1),u.ctxTransform(d[m].tr),c=d[m].nodes):c=d[m].trNodes,f=c.length,n=0;n<f;n+=1)"m"==c[n].t?g.moveTo(c[n].p[0],c[n].p[1]):g.bezierCurveTo(c[n].p1[0],c[n].p1[1],c[n].p2[0],c[n].p2[1],c[n].p3[0],c[n].p3[1]);"st"===v&&(g.stroke(),u.restore())}"st"!==v&&g.fill(),u.restore()}this.firstFrame&&(this.firstFrame=!1)}},CVShapeItemElement.prototype.renderPath=function(t,s,e){var r,a,o=s.sh.v;if(o.v){r=o.v.length;var i=e.matMdf||s.sh.mdf||this.firstFrame;if(i){var l=s.trNodes,p=s.nodes;l.length=0,p.length=0;var h=o.s?o.s:[];for(a=1;a<r;a+=1)h[a-1]?(s.st&&p.push({t:"m",p:h[a-1]}),s.fl&&l.push({t:"m",p:e.mat.applyToPointArray(h[a-1][0],h[a-1][1])})):1==a&&(s.st&&p.push({t:"m",p:o.v[0]}),s.fl&&l.push({t:"m",p:e.mat.applyToPointArray(o.v[0][0],o.v[0][1])})),s.st&&p.push({t:"c",p1:o.o[a-1],p2:o.i[a],p3:o.v[a]}),s.fl&&l.push({t:"c",p1:e.mat.applyToPointArray(o.o[a-1][0],o.o[a-1][1]),p2:e.mat.applyToPointArray(o.i[a][0],o.i[a][1]),p3:e.mat.applyToPointArray(o.v[a][0],o.v[a][1])});1==r&&(h[0]?(s.st&&p.push({t:"m",p:h[0]}),s.fl&&l.push({t:"m",p:e.mat.applyToPointArray(h[0][0],h[0][1])})):(s.st&&p.push({t:"m",p:o.v[0]}),s.fl&&l.push({t:"m",p:e.mat.applyToPointArray(o.v[0][0],o.v[0][1])}))),r&&t.closed&&(!t.trimmed||o.c)&&(s.st&&p.push({t:"c",p1:o.o[a-1],p2:o.i[0],p3:o.v[0]}),s.fl&&l.push({t:"c",p1:e.mat.applyToPointArray(o.o[a-1][0],o.o[a-1][1]),p2:e.mat.applyToPointArray(o.i[0][0],o.i[0][1]),p3:e.mat.applyToPointArray(o.v[0][0],o.v[0][1])})),s.st&&(s.tr[0]=e.mat.props[0],s.tr[1]=e.mat.props[1],s.tr[2]=e.mat.props[2],s.tr[3]=e.mat.props[3],s.tr[4]=e.mat.props[4],s.tr[5]=e.mat.props[5]),s.nodes=p,s.trNodes=l}}},CVShapeItemElement.prototype.renderFill=function(t,s,e){var r=s.style;(s.c.mdf||this.firstFrame)&&(r.co="rgb("+bm_floor(s.c.v[0])+","+bm_floor(s.c.v[1])+","+bm_floor(s.c.v[2])+")"),(s.o.mdf||e.opMdf||this.firstFrame)&&(r.coOp=s.o.v*e.opacity)},CVShapeItemElement.prototype.renderStroke=function(t,s,e){var r=s.style,a=s.d;a&&(a.mdf||this.firstFrame)&&(r.da=a.dasharray,r.do=a.dashoffset),(s.c.mdf||this.firstFrame)&&(r.co="rgb("+bm_floor(s.c.v[0])+","+bm_floor(s.c.v[1])+","+bm_floor(s.c.v[2])+")"),(s.o.mdf||e.opMdf||this.firstFrame)&&(r.coOp=s.o.v*e.opacity),(s.w.mdf||this.firstFrame)&&(r.wi=s.w.v)},CVShapeItemElement.prototype.destroy=function(){this.data=null,this.globalData=null,this.canvasContext=null};
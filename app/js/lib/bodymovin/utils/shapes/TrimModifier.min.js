function TrimModifier(){}extendPrototype(ShapeModifier,TrimModifier),TrimModifier.prototype.processKeys=function(e){if(this.elem.globalData.frameId!==this.frameId||e){this.mdf=!!e,this.frameId=this.elem.globalData.frameId;var t,h=this.dynamicProperties.length;for(t=0;t<h;t+=1)this.dynamicProperties[t].getValue(),this.dynamicProperties[t].mdf&&(this.mdf=!0);if(this.mdf||e){var s=this.o.v%360/360;s<0&&(s+=1);var i=this.s.v+s,a=this.e.v+s;if(i>a){var r=i;i=a,a=r}this.sValue=i,this.eValue=a,this.oValue=s}}},TrimModifier.prototype.initModifierProperties=function(e,t){this.sValue=0,this.eValue=0,this.oValue=0,this.getValue=this.processKeys,this.s=PropertyFactory.getProp(e,t.s,0,.01,this.dynamicProperties),this.e=PropertyFactory.getProp(e,t.e,0,.01,this.dynamicProperties),this.o=PropertyFactory.getProp(e,t.o,0,0,this.dynamicProperties),this.dynamicProperties.length||this.getValue(!0)},TrimModifier.prototype.getSegmentsLength=function(e){var t,h=e.c,s=e.v,i=e.o,a=e.i,r=s.length,o=[],p=0;for(t=0;t<r-1;t+=1)o[t]=bez.getBezierLength(s[t],s[t+1],i[t],a[t+1]),p+=o[t].addedLength;return h&&(o[t]=bez.getBezierLength(s[t],s[0],i[t],a[0]),p+=o[t].addedLength),{lengths:o,totalLength:p}},TrimModifier.prototype.processShapes=function(e){var t,h,s,i,a,r,o,p=this.shapes.length,d=this.sValue,n=this.eValue,g=0;if(n===d)for(h=0;h<p;h+=1)this.shapes[h].shape.paths=[],this.shapes[h].shape.mdf=!0;else{var f,l,m=[];for(h=0;h<p;h+=1){if(f=this.shapes[h],f.shape.mdf||this.mdf||e){if(t=f.shape.paths,i=t.length,o=0,!f.shape.mdf&&f.pathsData)o=f.totalShapeLength;else{for(a=[],s=0;s<i;s+=1)r=this.getSegmentsLength(t[s]),a.push(r),o+=r.totalLength;f.totalShapeLength=o,f.pathsData=a}g+=o}else f.shape.paths=f.last;f.shape.mdf=!0}for(h=0;h<p;h+=1)if(l=[],f=this.shapes[h],f.shape.mdf){m.length=0,n<=1?m.push({s:f.totalShapeLength*d,e:f.totalShapeLength*n}):d>=1?m.push({s:f.totalShapeLength*(d-1),e:f.totalShapeLength*(n-1)}):(m.push({s:f.totalShapeLength*d,e:f.totalShapeLength}),m.push({s:0,e:f.totalShapeLength*(n-1)}));var v,u=this.addShapes(f,m[0]);l.push(u),m.length>1&&(f.shape.v.c?this.addShapes(f,m[1],u):(u.i[0]=[u.v[0][0],u.v[0][1]],v=u.v.length-1,u.o[v]=[u.v[v][0],u.v[v][1]],u=this.addShapes(f,m[1]),l.push(u))),u.i[0]=[u.v[0][0],u.v[0][1]],v=u.v.length-1,u.o[v]=[u.v[v][0],u.v[v][1]],f.last=l,f.shape.paths=l}}this.dynamicProperties.length||(this.mdf=!1)},TrimModifier.prototype.addSegment=function(e,t,h,s,i,a){i.o[a]=t,i.i[a+1]=h,i.v[a+1]=s,i.v[a]=e},TrimModifier.prototype.addShapes=function(e,t,h){var s,i,a,r,o,p,d,n=e.pathsData,g=e.shape.paths,f=g.length,l=0;for(h?o=h.v.length-1:(h={c:!1,v:[],i:[],o:[]},o=0),s=0;s<f;s+=1){for(p=n[s].lengths,a=g[s].c?p.length:p.length+1,i=1;i<a;i+=1)if(r=p[i-1],l+r.addedLength<t.s)l+=r.addedLength;else{if(l>t.e)break;t.s<=l&&t.e>=l+r.addedLength?this.addSegment(g[s].v[i-1],g[s].o[i-1],g[s].i[i],g[s].v[i],h,o):(d=bez.getNewSegment(g[s].v[i-1],g[s].v[i],g[s].o[i-1],g[s].i[i],(t.s-l)/r.addedLength,(t.e-l)/r.addedLength,p[i-1]),this.addSegment(d.pt1,d.pt3,d.pt4,d.pt2,h,o)),l+=r.addedLength,o+=1}if(g[s].c&&l<=t.e){var m=p[i-1].addedLength;t.s<=l&&t.e>=l+m?this.addSegment(g[s].v[i-1],g[s].o[i-1],g[s].i[0],g[s].v[0],h,o):(d=bez.getNewSegment(g[s].v[i-1],g[s].v[0],g[s].o[i-1],g[s].i[0],(t.s-l)/m,(t.e-l)/m,p[i-1]),this.addSegment(d.pt1,d.pt3,d.pt4,d.pt2,h,o))}}return h},ShapeModifiers.registerModifier("tm",TrimModifier);
function MaskElement(t,e,a){this.dynamicProperties=[],this.data=t,this.element=e,this.globalData=a,this.paths=[],this.storedData=[],this.masksProperties=this.data.masksProperties,this.viewData=new Array(this.masksProperties.length),this.maskElement=null,this.firstFrame=!0;var s,i,r,o,l,h,n,m,p=this.globalData.defs,d=this.masksProperties.length,u=this.masksProperties,f=0,c=[],v=randomString(10),b="clipPath",k="clip-path";for(s=0;s<d;s++)if(("a"!==u[s].mode&&"n"!==u[s].mode||u[s].inv||100!==u[s].o.k)&&(b="mask",k="mask"),"s"!=u[s].mode&&"i"!=u[s].mode||0!=f?l=null:(l=document.createElementNS(svgNS,"rect"),l.setAttribute("fill","#ffffff"),l.setAttribute("width",this.element.comp.data?this.element.comp.data.w:this.element.globalData.compSize.w),l.setAttribute("height",this.element.comp.data?this.element.comp.data.h:this.element.globalData.compSize.h),c.push(l)),i=document.createElementNS(svgNS,"path"),"n"!=u[s].mode){if(f+=1,"s"==u[s].mode?i.setAttribute("fill","#000000"):i.setAttribute("fill","#ffffff"),i.setAttribute("clip-rule","nonzero"),0!==u[s].x.k){b="mask",k="mask",m=PropertyFactory.getProp(this.element,u[s].x,0,null,this.dynamicProperties);var P="fi_"+randomString(10);h=document.createElementNS(svgNS,"filter"),h.setAttribute("id",P),n=document.createElementNS(svgNS,"feMorphology"),n.setAttribute("operator","dilate"),n.setAttribute("in","SourceGraphic"),n.setAttribute("radius","0"),h.appendChild(n),p.appendChild(h),"s"==u[s].mode?i.setAttribute("stroke","#000000"):i.setAttribute("stroke","#ffffff")}else n=null,m=null;if(this.storedData[s]={elem:i,x:m,expan:n,lastPath:"",lastOperator:"",filterId:P,lastRadius:0},"i"==u[s].mode){o=c.length;var D=document.createElementNS(svgNS,"g");for(r=0;r<o;r+=1)D.appendChild(c[r]);var g=document.createElementNS(svgNS,"mask");g.setAttribute("mask-type","alpha"),g.setAttribute("id",v+"_"+f),g.appendChild(i),p.appendChild(g),D.setAttribute("mask","url(#"+v+"_"+f+")"),c.length=0,c.push(D)}else c.push(i);u[s].inv&&!this.solidPath&&(this.solidPath=this.createLayerSolidPath()),this.viewData[s]={elem:i,lastPath:"",op:PropertyFactory.getProp(this.element,u[s].o,0,.01,this.dynamicProperties),prop:ShapePropertyFactory.getShapeProp(this.element,u[s],3,this.dynamicProperties,null)},l&&(this.viewData[s].invRect=l),this.viewData[s].prop.k||this.drawPath(u[s],this.viewData[s].prop.v,this.viewData[s])}else this.viewData[s]={op:PropertyFactory.getProp(this.element,u[s].o,0,.01,this.dynamicProperties),prop:ShapePropertyFactory.getShapeProp(this.element,u[s],3,this.dynamicProperties,null),elem:i},p.appendChild(i);for(this.maskElement=document.createElementNS(svgNS,b),d=c.length,s=0;s<d;s+=1)this.maskElement.appendChild(c[s]);this.maskElement.setAttribute("id",v),f>0&&this.element.maskedElement.setAttribute(k,"url(#"+v+")"),p.appendChild(this.maskElement)}MaskElement.prototype.getMaskProperty=function(t){return this.viewData[t].prop},MaskElement.prototype.prepareFrame=function(){var t,e=this.dynamicProperties.length;for(t=0;t<e;t+=1)this.dynamicProperties[t].getValue()},MaskElement.prototype.renderFrame=function(t){var e,a=this.masksProperties.length;for(e=0;e<a;e++)if((this.viewData[e].prop.mdf||this.firstFrame)&&this.drawPath(this.masksProperties[e],this.viewData[e].prop.v,this.viewData[e]),(this.viewData[e].op.mdf||this.firstFrame)&&this.viewData[e].elem.setAttribute("fill-opacity",this.viewData[e].op.v),"n"!==this.masksProperties[e].mode&&(this.viewData[e].invRect&&(this.element.finalTransform.mProp.mdf||this.firstFrame)&&(this.viewData[e].invRect.setAttribute("x",-t.props[12]),this.viewData[e].invRect.setAttribute("y",-t.props[13])),this.storedData[e].x&&(this.storedData[e].x.mdf||this.firstFrame))){var s=this.storedData[e].expan;this.storedData[e].x.v<0?("erode"!==this.storedData[e].lastOperator&&(this.storedData[e].lastOperator="erode",this.storedData[e].elem.setAttribute("filter","url(#"+this.storedData[e].filterId+")")),s.setAttribute("radius",-this.storedData[e].x.v)):("dilate"!==this.storedData[e].lastOperator&&(this.storedData[e].lastOperator="dilate",this.storedData[e].elem.setAttribute("filter",null)),this.storedData[e].elem.setAttribute("stroke-width",2*this.storedData[e].x.v))}this.firstFrame=!1},MaskElement.prototype.getMaskelement=function(){return this.maskElement},MaskElement.prototype.createLayerSolidPath=function(){var t="M0,0 ";return t+=" h"+this.globalData.compSize.w,t+=" v"+this.globalData.compSize.h,t+=" h-"+this.globalData.compSize.w,t+=" v-"+this.globalData.compSize.h+" "},MaskElement.prototype.drawPath=function(t,e,a){var s,i,r="";for(i=e.v.length,s=1;s<i;s+=1)1==s&&(r+=" M"+bm_rnd(e.v[0][0])+","+bm_rnd(e.v[0][1])),r+=" C"+bm_rnd(e.o[s-1][0])+","+bm_rnd(e.o[s-1][1])+" "+bm_rnd(e.i[s][0])+","+bm_rnd(e.i[s][1])+" "+bm_rnd(e.v[s][0])+","+bm_rnd(e.v[s][1]);e.c&&i>1&&(r+=" C"+bm_rnd(e.o[s-1][0])+","+bm_rnd(e.o[s-1][1])+" "+bm_rnd(e.i[0][0])+","+bm_rnd(e.i[0][1])+" "+bm_rnd(e.v[0][0])+","+bm_rnd(e.v[0][1])),a.lastPath!==r&&(a.elem&&(e.c?t.inv?a.elem.setAttribute("d",this.solidPath+r):a.elem.setAttribute("d",r):a.elem.setAttribute("d","")),a.lastPath=r)},MaskElement.prototype.getMask=function(t){for(var e=0,a=this.masksProperties.length;e<a;){if(this.masksProperties[e].nm===t)return{maskPath:this.viewData[e].prop.pv};e+=1}},MaskElement.prototype.destroy=function(){this.element=null,this.globalData=null,this.maskElement=null,this.data=null,this.paths=null,this.masksProperties=null};